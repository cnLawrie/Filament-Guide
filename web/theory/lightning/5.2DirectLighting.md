# 直接照明

选择了物理学光单位意味着我们在shader计算出来的是流明单位的值，因此我们所有的估算光的函数都将计算给定节点的亮度L<sub>out</sub>（或出射辐射）。亮度结果基于光照度E和BSDF f(v,l)
L<sub>out</sub> = f(v,l)E

## 定向光
定向光的主要用途是在户外环境创建重要的光源（如太阳和月亮）。虽然现实世界中并不存在定向光，但是我们可以假设如果光源很远的话，那么它发出的光是定向的（即所有入射光线都是平行的，如图所示）

![diagram_directional_light](../../assets/lightning/5.2/diagram_directional_light.png)

这个假设对于表面的漫反射是没有问题的，但是对于镜面反射是错误的。寒霜引擎通过把太阳的定向光看做盘状的区域光来解决这个问题。

我们之前选择光照度(lx)作为定向光的单位，部分原因是因为我们可以很容易获得天空和太阳的光照度(从网上找或者自己用仪器测量），还可以简化上一节提到的亮度方程，如下：  

L<sub>out</sub> = f(v,l)E⊥ <n⋅l>

上式中，E⊥是垂直于光源的表面的光照度。例如，加入用定向光源模拟太阳，E⊥就是与太阳光方向垂直的表面的光照度。

下表提供了太阳和天空的光照度参考

![Table12](../../assets/lightning/5.2/Table12.png)

GLSL实现：
```
vec3 l = normalize(-lightDirection);
// dot是点乘函数，clamp是夹具函数，取三个数中的中间数
float NoL = clamp(dot(n, l), 0.0, 1.0);

// lightIntensity 垂直入射时的照明度
float illuminance = lightIntensity * NoL;
vec3 luminance = BSDF(v, l) * illuminance;
```

下图展示了模拟正午（照明度设为110,000lx)时，定向光照射一个简单场景的效果。

![screenshot_directional_light](../../assets/lightning/5.2/screenshot_directional_light.png)
图：定向光下的一排排不同粗糙度的电介质材质模型

## 精确光源

我们的引擎支持两类精确光源：点光源和聚光灯。这类光源通常在物理上来说并不精确，原因有两个
1. 他们在理论上是无穷小的
2. 他们并不遵循平方反比定律（平方反比定律又称为照度第一定律。它是一个关于光源照度与被照射物体之间距离关系的定律：在点光源的垂直照射下，被照射物体表面的照度，与光源的发光强度成正比，与光源至被照射物体的表面距离的平方成反比）

第一个问题可以用区域光来处理，但是，鉴于精确光源的开销较低，应该尽可能使用无限小的精确光源。
第二个问题很容易解决。
L<sub>out</sub> = f(v,l)E中的E由下式计算得出，其中d是光源至被照射物体的表面距离。

